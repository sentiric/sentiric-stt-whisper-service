name: sentiric

networks:
  sentiric-net:
    name: "${NETWORK_NAME:-sentiric.cloud}"
    driver: bridge
    ipam:
      config:
        - subnet: ${NETWORK_SUBNET:-10.88.0.0/16}
          gateway: ${NETWORK_GATEWAY:-10.88.0.1}


volumes:
  # =============================================================
  # KATMAN 4: YAPAY ZEKA UZMAN MOTORLARI (AI EXPERT ENGINES)
  # Gerçek AI işini yapan, potansiyel olarak yavaş başlayan servisler.
  # =============================================================

  # [capability-stt]: Konuşma Tanıma Yetenekleri (STT Capabilities)
  # --------------------------------------------------
  stt-whisper-models: 
  stt-whisper-cache:   

services:
  # =============================================================
  # KATMAN 4: YAPAY ZEKA UZMAN MOTORLARI (AI EXPERT ENGINES)
  # Gerçek AI işini yapan, potansiyel olarak yavaş başlayan servisler.
  # =============================================================

  stt-whisper-service:
    volumes:
      - "${CERTIFICATES_REPO_PATH}:/sentiric-certificates:ro"
      - stt-whisper-models:/models
    environment:
      - GRPC_TLS_CA_PATH=/sentiric-certificates/certs/ca.crt      
      - STT_WHISPER_SERVICE_CERT_PATH=/sentiric-certificates/certs/stt-whisper-service.crt
      - STT_WHISPER_SERVICE_KEY_PATH=/sentiric-certificates/certs/stt-whisper-service.key
    ports:
      - "${STT_WHISPER_SERVICE_HTTP_PORT:-15030}:${STT_WHISPER_SERVICE_HTTP_PORT:-15030}"
      - "${STT_WHISPER_SERVICE_GRPC_PORT:-15031}:${STT_WHISPER_SERVICE_GRPC_PORT:-15031}"
      - "${STT_WHISPER_SERVICE_METRICS_PORT:-15032}:${STT_WHISPER_SERVICE_METRICS_PORT:-15032}"                
    networks:
      sentiric-net:
        ipv4_address: ${STT_WHISPER_SERVICE_IPV4_ADDRESS:-10.88.50.3}
    dns:
      - ${DISCOVERY_SERVICE_IPV4_ADDRESS:-10.88.5.1}
      - ${PRIMARY_DNS:-8.8.8.8}
      - ${SECONDARY_DNS:-1.1.1.1}       
    dns_search:
      - ${DISCOVERY_DNS_SEARCH_DOMAIN}
    restart: always
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${STT_WHISPER_SERVICE_HTTP_PORT:-15030}/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10m # Modelin yüklenmesi uzun sürebilir